<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.gittest.todolist.ToDoListMapper">

    <insert id="postToDoList" useGeneratedKeys="true" keyProperty="listId">
        INSERT INTO todolist
        (user_id, title, content, start_date, deadline_date, is_completed, favorite)
        VALUES
        (#{userId}, #{title}, #{content}, #{startDate}, #{deadlineDate}, #{isCompleted}, #{favorite})
    </insert>
    <insert id="postToDoListPics" useGeneratedKeys="true" keyProperty="imageId">
        INSERT INTO todolist_image
        (list_id, content_image)
        VALUES
        <foreach item="item" collection="fileNames" separator=",">
            (#{listId}, #{item})
        </foreach>
    </insert>


    <select id="getToDoListByUserIdForRead">
        SELECT
        list_id AS listID, user_id AS userId, title, content, start_date AS startDate, deadline_date AS deadlineDate, is_completed AS isCompleted, favorite
        FROM
        todolist
        WHERE
        user_id = #{userId}
    </select>
    <select id="getContentImageByListId">
        SELECT content_image AS contentImage
        FROM todolist_image
        WHERE list_id = #{listId}
    </select>


    <update id="updateToDoList">
        UPDATE todolist
        SET
        title = #{title},
        content = #{content},
        start_date = #{startDate},
        deadline_date = #{deadlineDate},
        is_completed = #{isCompleted},
        favorite = #{favorite}
        WHERE
        user_id = #{userId}
        AND list_id = #{listId}
    </update>
    <select id="getToDoListByUserIdForUpdate">
        SELECT
        list_id AS listID, user_id AS userId, title, content, start_date AS startDate, deadline_date AS deadlineDate, is_completed AS isCompleted, favorite
        FROM
        todolist
        WHERE
        user_id = #{userId}
        AND list_id = #{listId}
    </select>


    <delete id ="deleteToDoList">
        DELETE from todolist
        where list_id = #{listId}
    </delete>
    <delete id ="deleteToDoListPics">
        DELETE from todolist_image
        where list_id = #{listId}
    </delete>

</mapper>

<!-- ver2 -->
        <!--    <insert id="postToDoList"-->
        <!--            useGeneratedKeys="true"-->
        <!--            keyProperty="listId">-->
        <!--        INSERT INTO todolist-->
        <!--        SET user_id = #{userId}-->
        <!--        , title = #{title}-->
        <!--        , content = #{content}-->
        <!--        , start_date = #{startDate}-->
        <!--        , deadline_date = #{deadlineDate}-->
        <!--        , is_completed = #{isCompleted}-->
        <!--        , favorite = #{favorite}-->
        <!--    </insert>-->

        <!--    <insert id="postToDoListPics">-->
        <!--        INSERT INTO todolist_image-->
        <!--        (list_id, content_image)-->
        <!--        VALUES-->
        <!--        <foreach item="item" collection="fileNames" separator=",">-->
        <!--            (#{listId}, #{item})-->
        <!--        </foreach>-->
        <!--    </insert>-->